#!/bin/bash

# Remove unnecessary pre-installed packages from debian gnome 
echo "Removing unnecessary packages..."
sudo apt-get purge -y cheese* aisleriot five-or-more four-in-a-row hitori lightsoff quadrapassel swell-foop tali
sudo apt autoremove -y
sudo apt clean

# Update the system
echo "Updating system..."
sudo apt update -y
sudo apt upgrade -y
sudo apt full-upgrade -y
sudo apt dist-upgrade -y

# Install essential utilities
echo "Installing essential utilities..."
sudo apt install -y git curl wget unzip nano build-essential tmux remmina remmina-plugin-rdp remmina-plugin-vnc ruby ruby-dev libcurl4-openssl-dev libffi-dev make gcc openvpn gnome-shell-extension-manager

# Install GDB
sudo apt update && sudo apt install -y gdb

# Install wpscan
sudo gem install wpscan

# Download and install GEF manually
mkdir -p ~/.gdb
wget -O ~/.gdbinit-gef.py https://github.com/hugsy/gef/raw/main/gef.py

# Add GEF to your GDB configuration
echo "source ~/.gdbinit-gef.py" >> ~/.gdbinit

echo "GEF installed successfully!"

# Install penetration testing tools
echo "Installing pythonvenv.."
sudo apt install python3.11-venv -y

# Install UrlFinder
echo "Installing irlfinder.."
go install -v github.com/projectdiscovery/urlfinder/cmd/urlfinder@latest

# Install gospider
echo "Installing Gospider.."
GO111MODULE=on go install github.com/jaeles-project/gospider@latest

echo "Installing Nmap..."
sudo apt install -y nmap

echo "Installing Wireshark..."
sudo apt install -y wireshark

# Enable Wireshark for non-root users (Optional)
sudo usermod -aG wireshark $(whoami)

echo "Installing John the Ripper..."
sudo apt install -y john
echo 'export PATH=$PATH:/usr/sbin' >> ~/.bashrc
source ~/.bashrc

echo "Installing aircrack-ng and hydra..."
sudo apt install -y aircrack-ng hydra

echo "Installing binwalk and exiftool..."
sudo apt install -y binwalk exiftool

# Install additional useful tools
echo "Installing netcat-openbsd, ncat, tcpdump, hashcat, ffuf, proxychains, and git..."
sudo apt install -y netcat-openbsd ncat tcpdump hashcat ffuf proxychains git

# Install Nuclei
echo "Installing Nuclei..."
go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest

# Install DirSearch
echo "Cloning DirSearch repository..."
git clone --depth 1 https://github.com/maurosoria/dirsearch.git ~/tools/dirsearch

# Create a symlink to use DirSearch globally
echo "Creating symlink for DirSearch..."
sudo ln -sf ~/tools/dirsearch/dirsearch.py /usr/local/bin/dirsearch

# Ensure the Python executable is correct (if needed)
echo "Checking Python version..."
if ! command -v python3 &> /dev/null; then
    echo "Python 3 is not installed. Installing Python 3..."
    sudo apt install python3
fi

# Create a symlink for python if it doesn't exist
if ! command -v python &> /dev/null; then
    echo "Creating symlink for Python..."
    sudo ln -s /usr/bin/python3 /usr/bin/python
fi

# moving sub-enum
echo "Creating symlink for sub-enum..."
mv ~/Desktop/sub-enum/ ~/tools/
sudo ln -sf ~/tools/sub-enum/sub.py /usr/local/bin/subenum
chmod +x ~/tools/sub-enum/sub.py

# Install required Python dependencies
echo "Installing Python dependencies..."
pip install -r ~/tools/dirsearch/requirements.txt --break-system-packages

# Test the installation
echo "Testing DirSearch installation..."
dirsearch --help

# Install Waybackurls using Go
echo "Installing Waybackurls..."
go install github.com/tomnomnom/waybackurls@latest

# Install sqlmap
echo "Installing sqlmap..."
git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git ~/tools/sqlmap-dev

# Create a symlink to use sqlmap globally
echo "Creating symlink for sqlmap..."
sudo ln -sf ~/tools/sqlmap-dev/sqlmap.py /usr/local/bin/sqlmap

# Ensure the Python executable is correct (if needed)
echo "Checking Python version..."
if ! command -v python3 &> /dev/null; then
    echo "Python 3 is not installed. Installing Python 3..."
    sudo apt install python3
fi

# Create a symlink for python if it doesn't exist
if ! command -v python &> /dev/null; then
    echo "Creating symlink for Python..."
    sudo ln -s /usr/bin/python3 /usr/bin/python
fi

# Test the installation
echo "Testing sqlmap installation..."
sqlmap -h

# Check if Metasploit (msfconsole) is already installed
if command -v msfconsole &>/dev/null; then
    echo "Metasploit is already installed. Skipping installation."
else
    echo "Installing Metasploit Framework..."
    curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
    chmod 755 msfinstall
    ./msfinstall
    rm msfinstall
fi

# Install seclists
# Define the target directory
TARGET_DIR="/usr/share/seclists"

# Download Seclists ZIP from GitHub
echo "Downloading Seclists..."
wget -c https://github.com/danielmiessler/SecLists/archive/master.zip -O /tmp/SecList.zip

# Unzip the downloaded file to the target directory
echo "Extracting Seclists to $TARGET_DIR..."
sudo unzip /tmp/SecList.zip -d /usr/share/

# Clean up the ZIP file
echo "Cleaning up..."
sudo rm -f /tmp/SecList.zip

# Rename extracted folder to 'seclists'
echo "Renaming extracted folder..."
sudo mv /usr/share/SecLists-master $TARGET_DIR

echo "Seclists installed successfully to $TARGET_DIR!"


# Installating searchsploit
# Define the target directory and repository URL
EXPLOITDB_DIR="/opt/exploitdb"
REPO_URL="https://gitlab.com/exploit-database/exploitdb.git"
SYMLINK_PATH="/usr/local/bin/searchsploit"

# Step 1: Clone the Exploit Database using sudo
echo "Cloning Exploit Database..."
sudo git clone $REPO_URL $EXPLOITDB_DIR

# Check if the clone was successful
if [ $? -ne 0 ]; then
    echo "Error: Failed to clone the repository."
    exit 1
fi

# Step 2: Create the symbolic link to searchsploit using sudo
echo "Creating symbolic link for searchsploit..."
sudo ln -sf $EXPLOITDB_DIR/searchsploit $SYMLINK_PATH

# Check if the symbolic link was created successfully
if [ ! -f $SYMLINK_PATH ]; then
    echo "Error: Symbolic link creation failed."
    exit 1
fi

# All steps completed successfully
echo "Exploit Database setup is complete. You can now use 'searchsploit' from anywhere."

# Installing CrackMapExec and its requirements
echo "Installing CrackMapExec and dependencies..."

# Update and install necessary packages
echo "Updating system and installing necessary packages..."
sudo apt update && sudo apt install -y git python3 python3-pip python3-dev build-essential curl

# Install Poetry if not already installed
if ! command -v poetry &> /dev/null
then
    echo "Poetry not found. Installing Poetry..."
    curl -sSL https://install.python-poetry.org | python3 -
    # Ensure poetry is in the PATH after installation
    export PATH="$HOME/.local/bin:$PATH"
    source ~/.bashrc  # Or `source ~/.zshrc` if you're using zsh
else
    echo "Poetry is already installed."
fi

# Verify Poetry installation before proceeding
if ! command -v poetry &> /dev/null
then
    echo "Error: Poetry is not installed or not found in the PATH."
    exit 1
fi

# Navigate to Desktop (assuming you're using a standard Linux setup)
echo "Navigating to Desktop directory..."
cd ~/Desktop

# Clone CrackMapExec repository on the Desktop
echo "Cloning CrackMapExec repository into Desktop..."
git clone https://github.com/byt3bl33d3r/CrackMapExec.git
cd CrackMapExec

# Install dependencies using Poetry
echo "Installing project dependencies..."
poetry install

# Check if virtual environment is created
VENV_PATH=$(poetry env info --path)

if [ ! -z "$VENV_PATH" ]; then
    echo "Virtual environment created at: $VENV_PATH"
else
    echo "Error: Virtual environment not found."
    exit 1
fi

# Activate the virtual environment manually
echo "Activating the virtual environment..."
source $VENV_PATH/bin/activate

# Install CrackMapExec in editable mode to ensure proper linking
echo "Reinstalling CrackMapExec in editable mode..."
pip install -e .

# Test the installation
echo "Testing CrackMapExec installation..."
crackmapexec --help

echo "CrackMapExec installation completed!"

# Install evil-winrm
Echo "Installing evil-winrm"
sudo gem install evil-winrm
echo "evil-winrm installation completed!"

# Installation of Impacket
echo "Installing pipx..."
python3 -m pip install --user pipx --break-system-packages
echo 'export PATH="$PATH:/home/shadownsa/.local/bin/pipx"' >> ~/.bashrc
sudo ln -s /home/shadownsa/.local/bin/pipx /usr/local/bin/pipx

# Reload shell configuration
echo "Reloading shell configuration..."
source ~/.bashrc 2>/dev/null

# Check pipx version
echo "Checking pipx version..."
pipx --version

# Install Impacket
echo "Installing Impacket..."
python3 -m pipx install impacket
echo "Installation complete!"

#Install Responder
# Navigate to the Desktop directory
cd ~/Desktop

# Clone the Responder repository
git clone https://github.com/lgandx/Responder.git

# Navigate into the Responder directory
cd Responder

# Create a Python virtual environment
python3 -m venv venv

# Activate the virtual environment
source venv/bin/activate

# Install the required Python packages
pip install -r requirements.txt

# Deactivate the virtual environment
deactivate

# Navigate to the Desktop directory
cd ~/Desktop

# Clean up
echo "Cleaning up..."
sudo apt autoremove -y
sudo apt clean

echo "Penetration Testing tools installation complete!"

# Reminder to install Burp Suite manually
echo ""
echo "========================================"
echo "REMINDER: Install Burp Suite manually from:"
echo "https://portswigger.net/burp/releases/professional-community-2024-12-1?requestededition=community&requestedplatform="
echo "========================================"

# Reminder to install ZAP Proxy
echo "========================================"
echo "REMINDER: Install ZAP Proxy from:"
echo "https://www.zaproxy.org/download/"
echo "========================================"
