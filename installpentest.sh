#!/bin/bash

# Remove unnecessary pre-installed packages from debian gnome 
echo "Removing unnecessary packages..."
sudo apt-get purge -y cheese* aisleriot five-or-more four-in-a-row hitori lightsoff quadrapassel swell-foop tali
sudo apt autoremove -y
sudo apt clean

# Update the system
echo "Updating system..."
sudo apt update -y
sudo apt upgrade -y
sudo apt full-upgrade -y
sudo apt dist-upgrade -y

# Install essential utilities
echo "Installing essential utilities..."
sudo apt install -y git curl wget unzip nano build-essential tmux remmina remmina-plugin-rdp remmina-plugin-vnc ruby ruby-dev libcurl4-openssl-dev libffi-dev make gcc

# Install GDB
sudo apt update && sudo apt install -y gdb

# Install wpscan
sudo gem install wpscan

# Download and install GEF manually
mkdir -p ~/.gdb
wget -O ~/.gdbinit-gef.py https://github.com/hugsy/gef/raw/main/gef.py

# Add GEF to your GDB configuration
echo "source ~/.gdbinit-gef.py" >> ~/.gdbinit

echo "GEF installed successfully!"

# Install penetration testing tools
echo "Installing pythonvenv.."
sudo apt install python3.11-venv -y

# Install UrlFinder
echo "Installing irlfinder.."
go install -v github.com/projectdiscovery/urlfinder/cmd/urlfinder@latest

# Install gospider
echo "Installing Gospider.."
GO111MODULE=on go install github.com/jaeles-project/gospider@latest

echo "Installing Nmap..."
sudo apt install -y nmap

echo "Installing Wireshark..."
sudo apt install -y wireshark

# Enable Wireshark for non-root users (Optional)
sudo usermod -aG wireshark $(whoami)

echo "Installing John the Ripper..."
sudo apt install -y john

echo "Installing aircrack-ng and hydra..."
sudo apt install -y aircrack-ng hydra

echo "Installing binwalk and exiftool..."
sudo apt install -y binwalk exiftool

# Install additional useful tools
echo "Installing netcat-openbsd, ncat, tcpdump, hashcat, ffuf, proxychains, and git..."
sudo apt install -y netcat-openbsd ncat tcpdump hashcat ffuf proxychains git

# Install Nuclei
echo "Installing Nuclei..."
go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest

# Install DirSearch
echo "Cloning DirSearch repository..."
git clone --depth 1 https://github.com/maurosoria/dirsearch.git ~/tools/dirsearch

# Create a symlink to use DirSearch globally
echo "Creating symlink for DirSearch..."
sudo ln -sf ~/tools/dirsearch/dirsearch.py /usr/local/bin/dirsearch

# Ensure the Python executable is correct (if needed)
echo "Checking Python version..."
if ! command -v python3 &> /dev/null; then
    echo "Python 3 is not installed. Installing Python 3..."
    sudo apt install python3
fi

# Create a symlink for python if it doesn't exist
if ! command -v python &> /dev/null; then
    echo "Creating symlink for Python..."
    sudo ln -s /usr/bin/python3 /usr/bin/python
fi

# moving sub-enum
echo "Creating symlink for sub-enum..."
mv ~/Desktop/sub-enum/sub.py ~/tools/
sudo ln -sf ~/tools/sub.py /usr/local/bin/subenum
chmod +x ~/tools/sub.py

# Install required Python dependencies
echo "Installing Python dependencies..."
pip install -r ~/tools/dirsearch/requirements.txt --break-system-packages

# Test the installation
echo "Testing DirSearch installation..."
dirsearch --help

# Install Waybackurls using Go
echo "Installing Waybackurls..."
go install github.com/tomnomnom/waybackurls@latest

# Install sqlmap
echo "Installing sqlmap..."
git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git ~/tools/sqlmap-dev

# Create a symlink to use sqlmap globally
echo "Creating symlink for sqlmap..."
sudo ln -sf ~/tools/sqlmap-dev/sqlmap.py /usr/local/bin/sqlmap

# Ensure the Python executable is correct (if needed)
echo "Checking Python version..."
if ! command -v python3 &> /dev/null; then
    echo "Python 3 is not installed. Installing Python 3..."
    sudo apt install python3
fi

# Create a symlink for python if it doesn't exist
if ! command -v python &> /dev/null; then
    echo "Creating symlink for Python..."
    sudo ln -s /usr/bin/python3 /usr/bin/python
fi

# Test the installation
echo "Testing sqlmap installation..."
sqlmap -h

# Check if Metasploit (msfconsole) is already installed
if command -v msfconsole &>/dev/null; then
    echo "Metasploit is already installed. Skipping installation."
else
    echo "Installing Metasploit Framework..."
    curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
    chmod 755 msfinstall
    ./msfinstall
    rm msfinstall
fi

# Install seclists
# Define the target directory
TARGET_DIR="/usr/share/seclists"

# Download Seclists ZIP from GitHub
echo "Downloading Seclists..."
wget -c https://github.com/danielmiessler/SecLists/archive/master.zip -O /tmp/SecList.zip

# Unzip the downloaded file to the target directory
echo "Extracting Seclists to $TARGET_DIR..."
sudo unzip /tmp/SecList.zip -d /usr/share/

# Clean up the ZIP file
echo "Cleaning up..."
sudo rm -f /tmp/SecList.zip

# Rename extracted folder to 'seclists'
echo "Renaming extracted folder..."
sudo mv /usr/share/SecLists-master $TARGET_DIR

echo "Seclists installed successfully to $TARGET_DIR!"


# Installating searchsploit
# Define the target directory and repository URL
EXPLOITDB_DIR="/opt/exploitdb"
REPO_URL="https://gitlab.com/exploit-database/exploitdb.git"
SYMLINK_PATH="/usr/local/bin/searchsploit"

# Step 1: Clone the Exploit Database using sudo
echo "Cloning Exploit Database..."
sudo git clone $REPO_URL $EXPLOITDB_DIR

# Check if the clone was successful
if [ $? -ne 0 ]; then
    echo "Error: Failed to clone the repository."
    exit 1
fi

# Step 2: Create the symbolic link to searchsploit using sudo
echo "Creating symbolic link for searchsploit..."
sudo ln -sf $EXPLOITDB_DIR/searchsploit $SYMLINK_PATH

# Check if the symbolic link was created successfully
if [ ! -f $SYMLINK_PATH ]; then
    echo "Error: Symbolic link creation failed."
    exit 1
fi

# Step 3: Verify the link works
echo "Verifying searchsploit command..."
searchsploit --help

# Check if searchsploit command works
if [ $? -ne 0 ]; then
    echo "Error: searchsploit command is not working correctly."
    exit 1
fi

# All steps completed successfully
echo "Exploit Database setup is complete. You can now use 'searchsploit' from anywhere."

# Clean up
echo "Cleaning up..."
sudo apt autoremove -y
sudo apt clean

echo "Penetration Testing tools installation complete!"

# Reminder to install Burp Suite manually
echo ""
echo "========================================"
echo "REMINDER: Install Burp Suite manually from:"
echo "https://portswigger.net/burp/releases/professional-community-2024-12-1?requestededition=community&requestedplatform="
echo "========================================"

# Reminder to install ZAP Proxy
echo "========================================"
echo "REMINDER: Install ZAP Proxy from:"
echo "https://www.zaproxy.org/download/"
echo "========================================"
